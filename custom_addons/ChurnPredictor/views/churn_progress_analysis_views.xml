<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- =================================================================== -->
    <!-- PHÂN TÍCH 1: THEO PHÂN KHÚC KHÁCH HÀNG (SEGMENT)                     -->
    <!-- =================================================================== -->

    <!-- Định nghĩa Graph View cho Segment -->
    <record id="view_churn_analysis_by_segment_graph" model="ir.ui.view">
        <field name="name">churn.analysis.by.segment.graph</field>
        <field name="model">churn.prediction</field>
        <field name="arch" type="xml">
            <graph string="Analysis by Customer Segment" type="bar">
                <!-- Trục X (row) cố định là Segment -->
                <field name="x_feat_segment" type="row"/>
                <!-- 
                    Trục Y (measure) có thể được thay đổi.
                    churn_rate sẽ là measure mặc định.
                -->
                <field name="churn_rate" type="measure" operator="avg"/>
                <field name="probability" type="measure" operator="avg"/>
                <field name="id" type="measure" operator="count"/>
            </graph>
        </field>
    </record>

    <!-- Định nghĩa Pivot View cho Segment -->
    <record id="view_churn_analysis_by_segment_pivot" model="ir.ui.view">
        <field name="name">churn.analysis.by.segment.pivot</field>
        <field name="model">churn.prediction</field>
        <field name="arch" type="xml">
            <pivot string="Analysis by Customer Segment">
                <field name="x_feat_segment" type="row"/>
                <field name="churn_rate" type="measure" operator="avg"/>
                <field name="id" type="measure" operator="count"/>
            </pivot>
        </field>
    </record>

    <!-- Action cho Segment: Odoo sẽ tự động tìm các view ở trên -->
    <record id="action_churn_analysis_by_segment" model="ir.actions.act_window">
        <field name="name">Analysis by Customer Segment</field>
        <field name="res_model">churn.prediction</field>
        <field name="view_mode">graph,pivot,tree</field>
    </record>

    <!-- =================================================================== -->
    <!-- PHÂN TÍCH 2: THEO DANH MỤC SẢN PHẨM (PRODUCT CATEGORY)              -->
    <!-- =================================================================== -->

    <!-- Định nghĩa Graph View cho Category -->
    <record id="view_churn_analysis_by_category_graph" model="ir.ui.view">
        <field name="name">churn.analysis.by.category.graph</field>
        <field name="model">churn.prediction</field>
        <field name="arch" type="xml">
            <graph string="Analysis by Product Category" type="bar">
                <!-- Trục X (row) cố định là Product Category -->
                <field name="x_feat_product_category_name_english_last" type="row"/>
                <!-- 
                    Trục Y (measure) có thể được thay đổi.
                    id (count) sẽ là measure mặc định.
                -->
                <field name="id" type="measure" operator="count"/>
                <field name="churn_rate" type="measure" operator="avg"/>
                <field name="x_feat_category_avg_gap" type="measure" operator="avg"/>
            </graph>
        </field>
    </record>

    <!-- Định nghĩa Pivot View cho Category -->
    <record id="view_churn_analysis_by_category_pivot" model="ir.ui.view">
        <field name="name">churn.analysis.by.category.pivot</field>
        <field name="model">churn.prediction</field>
        <field name="arch" type="xml">
            <pivot string="Analysis by Product Category">
                <field name="x_feat_product_category_name_english_last" type="row"/>
                <field name="id" type="measure" operator="count"/>
                <field name="churn_rate" type="measure" operator="avg"/>
                <field name="x_feat_category_avg_gap"/> <!-- Đã sửa, không cần operator -->
            </pivot>
        </field>
    </record>
    
    <!-- Action cho Category: Odoo sẽ tự động tìm các view ở trên -->
    <record id="action_churn_analysis_by_category" model="ir.actions.act_window">
        <field name="name">Analysis by Product Category</field>
        <field name="res_model">churn.prediction</field>
        <field name="view_mode">graph,pivot,tree</field>
    </record>

    <!-- =================================================================== -->
    <!-- MENU ITEMS (Giữ nguyên)                                            -->
    <!-- =================================================================== -->
    <menuitem id="menu_churn_progress_analysis_root" name="Progress Analysis" parent="menu_churn_root" sequence="3"/>
    <menuitem id="menu_churn_analysis_by_segment" name="By Customer Segment" parent="menu_churn_progress_analysis_root" action="action_churn_analysis_by_segment" sequence="1"/>
    <menuitem id="menu_churn_analysis_by_category" name="By Product Category" parent="menu_churn_progress_analysis_root" action="action_churn_analysis_by_category" sequence="2"/>

</odoo>