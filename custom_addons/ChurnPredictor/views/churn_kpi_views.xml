<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ====================================================== -->
    <!-- 1. ĐỊNH NGHĨA VIEW CHO CÁC THẺ KPI                   -->
    <!-- ====================================================== -->
    <record id="view_churn_prediction_kpi_graph" model="ir.ui.view">
        <field name="name">churn.prediction.kpi.graph</field>
        <field name="model">churn.prediction</field>
        <field name="arch" type="xml">
            <!-- 
                Chúng ta dùng graph type="bar" nhưng sẽ không hiển thị biểu đồ,
                chỉ dùng nó để tính toán các con số.
            -->
            <graph string="Churn KPIs" type="bar" disable_linking="1">
                <!-- 
                    - 'churn_rate' là một trường computed (sẽ tạo ở bước 2).
                    - 'probability' là trường có sẵn.
                    - 'count' là một biến đặc biệt để đếm số lượng bản ghi.
                -->
                <field name="churn_rate" type="measure" operator="+"/>
                <field name="probability" type="measure" operator="avg"/>
                <field name="id" string="Total Predictions" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- ====================================================== -->
    <!-- 2. TẠO ACTION ĐỂ GỌI VIEW KPI                      -->
    <!-- ====================================================== -->
    <record id="action_churn_kpi" model="ir.actions.act_window">
        <field name="name">Churn KPIs</field>
        <field name="res_model">churn.prediction</field>
        <!-- 
            view_mode="graph" để mở trực tiếp chế độ xem biểu đồ.
            'disable_linking="1"' ở trên sẽ làm cho các thẻ số không thể click vào được.
        -->
        <field name="view_mode">graph</field>
        <field name="view_id" ref="view_churn_prediction_kpi_graph"/>
    </record>

    <record id="action_churn_main_dashboard" model="ir.actions.act_window">
        <field name="name">Churn Dashboard</field>
        <field name="res_model">churn.prediction</field>
        <!--
            Đây là phần quan trọng nhất:
            - view_mode: Liệt kê tất cả các chế độ xem bạn muốn.
            - Chế độ xem đầu tiên trong danh sách (graph) sẽ là chế độ mặc định.
        -->
        <field name="view_mode">graph,pivot,kanban,tree</field>
        <field name="context">{'form_view_ref': 'churn_prediction_spa_action_tag'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No data found. Create some predictions to see your dashboard!
            </p>
        </field>
    </record>

    <!-- ====================================================== -->
    <!-- 3. TẠO MENU ITEM ĐỂ MỞ TRANG KPI                   -->
    <!-- ====================================================== -->
    <menuitem
        id="menu_churn_kpi"
        name="KPIs"
        parent="menu_churn_root"
        action="action_churn_kpi"
        sequence="2"/> <!-- Đặt sau "Predictions" và "Dashboard" -->

</odoo>